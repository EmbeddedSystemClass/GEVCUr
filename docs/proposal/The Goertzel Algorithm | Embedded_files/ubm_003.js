function UBMBookmarkService(){this.saveFollowDropSelector=".save-dropdown",this.saveFollowDropContainer="",this.saveFollowAnchor="a.save-follow",this.contentItemSelector="a.save-content",this.commentSelector="a.follow-comment",this.authorSelector="a.follow-author",this.userSelector="a.follow-user",this.followContent=function(o){var t=this;this.AjaxCall({method:"FollowContent",params:{contentItemId:o},callback:function(e){return e.success||t.isLoginError(e)||alert("Failed to Add item to My Library"),t.updateInterface("ContentItem",o,!1),!1}})},this.followComment=function(o){var t=this;this.AjaxCall({method:"FollowComment",params:{contentItemId:o},callback:function(e){return e.success||t.isLoginError(e)||alert("Failed to Add item to My Library"),t.updateInterface("ContentItemComments",o,!1),!1}})},this.followUser=function(o){var t=this;this.AjaxCall({method:"FollowSiteUser",params:{userId:o},callback:function(e){return e.success||t.isLoginError(e)||alert("Failed to Add user to My Library"),t.updateInterface("User",o,!1),!1}})},this.getForUser=function(){var o=this;this.AjaxCall({method:"Get",callback:function(t){t.success&&o.processBookmarks(t.Bookmarks)}})},this.processBookmarks=function(o){var t=this;$.each(o,function(){t.updateInterface(this.type,this.id,!1)})},this.removeBookmark=function(o,t){var e=this;this.AjaxCall({method:"Delete",params:{bookmarkType:o,id:t},callback:function(r){return r.success||e.isLoginError(r)||alert("Failed to Remove item to My Library"),e.updateInterface(o,t,!0),!1}})},this.updateInterface=function(o,t,e){var r=this,n=$(this.saveFollowDropSelector+".content_"+t);if("ContentItem"==o){var i=e?"Save to My Library":"Remove from My Library",l=n.find(this.contentItemSelector);l&&(l.text(i),l.off("click"),l.on("click",function(){return e?r.followContent(t):r.removeBookmark("ContentItem",t),!1}))}else if("ContentItemComments"==o){i=e?"Follow Comments":"Stop Following Comments";var a=n.find(this.commentSelector);a&&(a.text(i),a.off(),a.on("click",function(){return e?r.followComment(t):r.removeBookmark("ContentItemComments",t),!1}))}else if("User"==o){var s=(n=$(this.saveFollowDropSelector+".author_"+t)).find(this.authorSelector),c=$(this.userSelector);if(s.length>0)i=e?"Follow Author":"Stop Following Author",s.text(i),s.off("click"),s.on("click",function(){return e?r.followUser(t):r.removeBookmark("User",t),!1});else if(c.length>0){c.attr("data-userid")==t&&(c.off("click"),i=e?"Follow":"Stop Following",c.text(i),c.on("click",function(){return e?r.followUser(t):r.removeBookmark("User",t),!1}))}}},this.setupProfile=function(){var o=this,t=$(o.userSelector);if(t.length>0){var e=t.attr("data-userid");t.text("Follow"),t.on("click",function(){return o.followUser(e),!1})}},this.applySaveFollow=function(o){var t=this,e=t.saveFollowDropSelector;o.length>0&&(e=o+" "+e),$.each($(e),function(){var o=$(this).attr("data-contentitemid"),e=$(this).attr("data-authorid"),r=$(this).find(t.contentItemSelector);r&&(r.off("click"),r.on("click",function(){return t.followContent(o),!1})),(r=$(this).find(t.commentSelector))&&(r.off("click"),r.on("click",function(){return t.followComment(o),!1})),(r=$(this).find(t.userSelector))&&(r.off("click"),r.on("click",function(){return t.followUser(o),!1})),void 0!==e&&e.length&&(r=$(this).find(t.authorSelector))&&(r.off("click"),r.on("click",function(){return t.followUser(e),!1}))})},this.setupSaveFollowLinks=function(o){var t=this.saveFollowAnchor,e=this.saveFollowDropSelector;o.length>0&&(t=o+" "+t,e=o+" "+e),$(t).off("click"),$(t).on("click",function(){return $(this).next().slideToggle(400),!1}),$(e).mouseleave(function(){$(e).slideUp()})},this.isLoginError=function(o){return!(!o.errorType||"Login"!=o.errorType)&&(alert(o.message),janrain.capture.ui.renderScreen("signIn"),!0)}}UBMBookmarkService.prototype=new UBMService("/Bookmark/");var _bookmarkService=new UBMBookmarkService;function RemoveBookmarkFromLibraryUpdateCount(o,t,e,r,n){$.post("/Bookmark/RemoveBookmark",{bookmarkType:o,itemId:t,returnUrl:window.location.href},function(o){o.success?(n-=1,null!=e&&$("."+e).hide(),null!=r&&(r.toString().indexOf("MyLibraryRow_")>-1&&($("."+r).text("My Library("+n+")"),$(".MyLibraryRow_").attr("data-count",n)),r.toString().indexOf("MyToolsRow_")>-1&&($("."+r).text("My Tools("+n+")"),$(".MyToolsRow_").attr("data-count",n)),r.toString().indexOf("DiscussionRow_")>-1&&($("."+r).text("Discussion I'm Following("+n+")"),$(".DiscussionRow_").attr("data-count",n)),r.toString().indexOf("PeoplesRow_")>-1&&($("."+r).text("People I'm Following("+n+")"),$(".PeoplesRow_").attr("data-count",n)))):IsLoginError(o)||alert("Failed to Remove item from My Library")},"json")}